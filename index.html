<!DOCTYPE html>
<html>
    <head>
        <title>Spinning Wheel</title>

        <!-- reference css library -->
        <link rel="stylesheet" href="style/main.css" type="text/css" />
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css"/>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.min.css"/>
        <!-- reference bootstrap5-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <!-- reference w3school css -->
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">

        <!-- reference script library -->
        <script type="text/javascript" src="js/Winwheel.min.js"></script>
        <script type="text/javascript" src="js/TweenMax.min.js"></script>
        <script type="text/javascript" src="js/jquery-3.5.0.min.js"></script>
        <script type="text/javascript" src="js/alertify.js"></script>
        <!-- <script src="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script> -->

    </head>
    <body>
        <h1 id='top'> 'use the spinning wheel to make decision' </h1>
        <!-- display all content as table -->
        <table cellpadding="30" class="table-block ">
            <tr>
                <!-- add promt segment -->
                <td>
                    <form id="segmentForm">
                        <h3>Add Segment</h3>
                        <label for="segmentText">Segment Text:</label>
                        <input type="text" id="segmentText" required><br><br>
                        <label for="segmentColor">Segment Color:</label>
                        <input type="color" id="segmentColor" value="#FF8CA1" required><br><br>
                        <button type="button" onclick="addSegment()">Add Segment</button>
                        <button type="button" onclick="clearSegment()">Clear Segment</button>
                    </form>
                    <!-- printout list of segments has populated -->
                    <div id="segmentsList">
                        <h3>Segments List:</h3>
                        <ul id="segmentItems"></ul>
                    </div>
                </td>
                <!-- add promt spin power -->
                <td class="center">
                        <table class="power" cellpadding="15" cellspacing="0">
                            <tr>
                                <a class="text">spin power</a>
                            </tr>
                            <tr>
                                <br>
                            </tr>                      
                            <tr>
                                <div class="btn-group" role="group">
                                    <label><button type="button" id="pw1" class="btn btn-dark" onClick="powerSelected(1)">LOW</button></label>
                                    <label><button type="button" id="pw2" class="btn btn-dark" onClick="powerSelected(2)">MID</button></label>
                                    <label><button type="button" id="pw3" class="btn btn-dark" onClick="powerSelected(3)">HIGH</button></label>
                                </div>
                            </tr>
                            <tr>
                                <td>
                                    <button type="button" id="spin_button" class="btn btn-secondary" onclick="startSpin()"> START </button>
                                </td>
                                <td>
                                    <button type="button" class="btn btn-secondary"  onclick="window.open('https://www.buymeacoffee.com/thisistroyza', '_blank'); return false;"> DONATE </button>
                            </td>   
                            </tr>
                        </table>
                </td>
                <!-- add promt wheel canvas -->
                <td width="400" height="400" class="wheel-layout" align="center" valign="center">
                    <canvas id="canvas" width="430" height="430">
                        <p style="color: white" align="center">Sorry, your browser doesn't support canvas. Please try another.</p>
                    </canvas>
                </td>
            </tr>
        </table>

        <script>

            // -------------------------------------------------------
            // INITALIZE REQUIRED VARIABLES
            // -------------------------------------------------------
            const defaultWheelsegments = [
                {
                    fillStyle: '#FF8CA1',
                    text: 'sample1'
                },
                {
                    fillStyle: '#FF8CA1',
                    text: 'sample2'
                },
                {
                    fillStyle: '#FF8CA1',
                    text: 'sample3'
                }
            ]; 
            let wheelSegments = defaultWheelsegments;
            let wheelPower = 1; 
            let wheelSpinning = false;
            let theWheel = new Winwheel({
                'numSegments'  : defaultWheelsegments.length,     // Specify number of segments.
                'outerRadius'  : 160,   // Set outer radius so wheel fits inside the background.
                'textFontSize' : 15,    // Set font size as desired.
                'segments'     : defaultWheelsegments,      // Define segments including colour and text,
                'animation' :           // Specify the animation to use.
                {
                    'type'     : 'spinToStop',
                    'duration' : 3,    
                    'spins'    : 5,     
                    'callbackFinished' : alertResults
                }
            });

            //render the list of segment in initialization
            refreshSegmenListtDisplay();

            // -------------------------------------------------------
            // SEGMENTS: add segments for the wheel
            // -------------------------------------------------------
            function addSegment() {
                const segmentText = document.getElementById("segmentText").value;
                const segmentColor = document.getElementById("segmentColor").value;

                //validate segment text to be not null
                if (segmentText === null || segmentText === undefined || segmentText === '') return;

                //make sure to clear default segment when user adds a new segment
                if (JSON.stringify(wheelSegments) === JSON.stringify(defaultWheelsegments)) { 
                    wheelSegments = []; 
                }

                //initialize new segment
                wheelSegments.push({
                    fillStyle: segmentColor,
                    text: segmentText
                });
                
                //clear the text box
                document.getElementById("segmentText").value = '';

                //update segment + refresh the list
                updateWheelSegments();
                refreshSegmenListtDisplay();
            }

            // -------------------------------------------------------
            // SEGMENTS: clear all wheel segements and set it back to default
            // -------------------------------------------------------
            function clearSegment() {
                //Reset wheelSegments to default
                wheelSegments = defaultWheelsegments;

                updateWheelSegments();
                refreshSegmenListtDisplay();
            }

            // -------------------------------------------------------
            // SEGMENTS: perform update segments for the wheel
            // -------------------------------------------------------
            function updateWheelSegments() {
                theWheel = new Winwheel({
                    'numSegments': wheelSegments.length,
                    'outerRadius': 160,
                    'textFontSize': 15,
                    'segments': wheelSegments,
                    'animation': {
                        'type': 'spinToStop',
                        'duration': 3,
                        'spins': 5,
                        'callbackFinished': alertResults
                    }
                });
            }

            // -------------------------------------------------------
            // SEGMENTS: refresh the segement list display
            // -------------------------------------------------------
            function refreshSegmenListtDisplay() {
                const segmentItems = document.getElementById("segmentItems");
                // Clear the current list
                segmentItems.innerHTML = '';

                // Append each segment
                wheelSegments.forEach(segment => {
                    const li = document.createElement('li');
                    li.textContent = `${segment.text}`;
                    segmentItems.appendChild(li);
                });
            }


            // -------------------------------------------------------
            // POWER FUNCTION: define the power of the wheel
            // -------------------------------------------------------
            function powerSelected(powerLevel)
            {
                // Ensure that power can't be changed while wheel is spinning.
                if (wheelSpinning == false) {
                    // Reset all to grey incase this is not the first time the user has selected the power.
                    document.getElementById('pw1').className = "";
                    document.getElementById('pw2').className = "";
                    document.getElementById('pw3').className = "";

                    // Now light up all cells below-and-including the one selected by changing the class.
                    if (powerLevel >= 1) {
                        document.getElementById('pw1').className = "pw1";
                    }

                    if (powerLevel >= 2) {
                        document.getElementById('pw2').className = "pw2";
                    }

                    if (powerLevel >= 3) {
                        document.getElementById('pw3').className = "pw3";
                    }

                    // Set wheelPower var used when spin button is clicked.
                    wheelPower = powerLevel;
                }
            }

            // -------------------------------------------------------
            // WHEEL FUNCTION: start spinning wheel
            // -------------------------------------------------------
            function startSpin()
            {
                if (wheelSpinning == false) {
                    
                    // Define power and number of rotation
                    if (wheelPower == 1) {
                        theWheel.animation.spins = 3;
                    } else if (wheelPower == 2) {
                        theWheel.animation.spins = 8;
                    } else if (wheelPower == 3) {
                        theWheel.animation.spins = 15;
                    }

                    // Start animation
                    theWheel.startAnimation();

                    // Allow to trigger again during the spin
                    wheelSpinning = true;
                }
            }

            // -------------------------------------------------------
            // WHEEL FUNCTION: reset the spinning wheel
            // -------------------------------------------------------
            function resetWheel()
            {           
                theWheel.stopAnimation(false);  // Stop the animation, false as param so does not call callback function.
                theWheel.rotationAngle = 0;     // Re-set the wheel angle to 0 degrees.
                theWheel.draw();                // Call draw to render changes to the wheel.

                document.getElementById('pw1').className = "";  // Remove all colours from the power level indicators.
                document.getElementById('pw2').className = "";
                document.getElementById('pw3').className = "";

                wheelSpinning = false;          // Reset to false to power buttons and spin can be clicked again.
            }

            // -------------------------------------------------------
            // Called when the spin animation has finished by the callback feature of the wheel because I specified callback in the parameters
            // note the indicated segment is passed in as a parmeter as 99% of the time you will want to know this to inform the user of their prize.
            // -------------------------------------------------------
            function alertResults(indicatedSegment)
            {
                // Do basic alert of the segment text. You would probably want to do something more interesting with this information.
                alertify.alert(
                    'RESULT', 
                    'YOU NEED TO: ' + indicatedSegment.text, 
                    
                    function (){ 
                        alertify.success(indicatedSegment.text); 
                        resetWheel();
                    });
            }

            // -------------------------------------------------------
            // Windows client api: add segment by Enter
            // -------------------------------------------------------
            $(window).keypress(function (e){
                if (e.which === 13) {
                    addSegment();
                }
            });

        </script>

        <footer>
            <div>
                <p>sponsor by a broke developer</p>
            </div>
        </footer>

    </body>
</html>